{% extends "invitados/base.html" %}

{% block styles %}
.card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
.form-group {
    margin-bottom: 1.5rem;
}
.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #333;
}
.form-group input, .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
}
.btn {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
}
.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.status {
    margin-top: 1rem;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    display: none;
}
.status.success { background: #d4edda; color: #155724; }
.status.error { background: #f8d7da; color: #721c24; }
{% endblock %}

{% block content %}
<div class="card">
    <h2 style="text-align: center; margin-bottom: 1.5rem;">üì∏ Compart√≠ tus Fotos</h2>
    
    <form id="uploadForm" enctype="multipart/form-data">
        <div class="form-group">
            <label for="nombre">Tu nombre (opcional)</label>
            <input type="text" id="nombre" name="nombre" placeholder="Ej: Juan">
        </div>

        <div class="form-group">
            <label for="descripcion">Descripci√≥n (opcional)</label>
            <textarea id="descripcion" name="descripcion" rows="2" placeholder="Ej: Momento de la ceremonia"></textarea>
        </div>

        <div class="form-group">
            <label for="foto">Seleccionar foto</label>
            <input type="file" id="foto" name="foto" accept="capture=camera,image/*" required>
        </div>

        <button type="submit" class="btn" id="uploadBtn">
            <span id="uploadText">üì§ Subir Foto</span>
            <span id="uploadSpinner" style="display: none;">‚è≥ Subiendo...</span>
        </button>
    </form>

    <div id="uploadStatus" class="status"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('uploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadText = document.getElementById('uploadText');
    const uploadSpinner = document.getElementById('uploadSpinner');
    const uploadStatus = document.getElementById('uploadStatus');
    
    uploadBtn.disabled = true;
    uploadText.style.display = 'none';
    uploadSpinner.style.display = 'inline';
    uploadStatus.style.display = 'none';
    
    try {
        const response = await fetch('/api/fotos/upload', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            uploadStatus.className = 'status success';
            uploadStatus.textContent = '‚úì ' + data.message;
            uploadStatus.style.display = 'block';
            
            document.getElementById('uploadForm').reset();
            
            setTimeout(() => {
                uploadStatus.style.display = 'none';
            }, 3000);
        } else {
            throw new Error(data.message);
        }
    } catch (error) {
        uploadStatus.className = 'status error';
        uploadStatus.textContent = '‚úó Error: ' + error.message;
        uploadStatus.style.display = 'block';
    } finally {
        uploadBtn.disabled = false;
        uploadText.style.display = 'inline';
        uploadSpinner.style.display = 'none';
    }
});
</script>
{% endblock %}
